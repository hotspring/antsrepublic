<%= simple_form_for(@task) do |f| %>
  <%= f.error_notification %>
  <div class="task-unit">
<!--     <span class="task-time">
      <div class="form-group">
        <input type="text" name="task[dead_line]" class="form-control">
      </div>
    </span> -->
    <span class="task-plan">
      <%= f.input :plan_id, collection: @need.plans.map{|n| ["#{n.title}[#{n.dead_line}]", n.id]}, label: '选择计划' %>
    </span>    
    <span class="task-title">
      <%= f.input :title, label: '成果简介' %>
    </span>
    <span class="task-description">
      <%= f.input :description, label: '补充说明' %>
    </span>
    <%= f.input :need_id, as: :hidden, value: params[:need_id].blank? ? @task.need_id : params[:need_id] %>
    <span class="task-action">
      <%= f.button :submit %>
    </span>
  </div>
<% end %>

<%= form_for [@task, @attachment], :html => { :multipart => true, :id => "fileupload"  } do |f| %>
  <div class="row">
    <div class=" fileupload-buttonbar">
      <div class="progressbar fileupload-progressbar nofade"><div style="width:0%;"></div></div>
      <span class="btn btn-mini fileinput-button">
        <i class="icon-plus"></i>
        <span><%= '添加附件' %>...</span>
        <%= f.file_field :file, :multiple => true %>
      </span>
    </div>
  </div>
  <br>
  <div class="row">
    <ul class="thumbnails files">
      <% unless @attachments.empty? %>
        <% @attachments.each do |attachment| %>
            <li class="span3" id="attachment_<%= pic.id %>">
            <%= link_to attachment.file_name, attachment.file.url %>
            </li>
        <% end %>
      <% end %>
    </ul>
  </div>
<% end %>
<script>
  var fileUploadErrors = {
    maxFileSize: 'File is too big',
    minFileSize: 'File is too small',
    acceptFileTypes: 'Filetype not allowed',
    maxNumberOfFiles: 'Max number of files exceeded',
    uploadedBytes: 'Uploaded bytes exceed file size',
    emptyResult: 'Empty file upload result'
  };
</script>