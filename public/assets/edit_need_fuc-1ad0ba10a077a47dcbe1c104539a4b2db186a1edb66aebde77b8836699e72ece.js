!function(){function e(e){e.selector.select2({placeholder:e.placeholder,ajax:{url:e.url,method:"GET",dataType:"json",delay:250,data:function(e){return{q:e.term}},processResults:e.processResultsFuc,cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1,templateResult:n,templateSelection:s})}function t(e){var t='      <a class="queen" href="javascript:void(0)" data-case="'+e.id+'">          <p>          \t<img src="'+e.avatar_small_url+'" class="img-circle">          </p>          <h6>'+e.title+'          </h6>\t\t\t<span class="delete_btn btn" data-id="'+e.id+'" data-type="case">                \u5220\u9664           </span>';$('<div class="col-md-2 col-case-and-queen text-center"></div>').append($(t).click(function(e){$(e.currentTarget).toggleClass("selected")}).find("span.delete_btn").click(l).parent()).appendTo(".selected_case_list")}function a(e){var t='      <a class="queen" href="javascript:void(0)">          <p>          \t<img src="'+e.avatar_small_url+'" class="img-circle">          </p>          <h6>'+e.name+'          </h6>\t\t\t<span class="delete_btn btn" data-id="'+e.id+'" data-type="queen">                \u5220\u9664           </span>';$('<div class="col-md-2 col-case-and-queen text-center"></div>').append($(t).click(function(e){$(e.currentTarget).toggleClass("selected")}).find("span.delete_btn").click(l).parent()).appendTo(".selected_queen_list")}function n(e){if(e.loading)return e.text;var t=void 0==e.title?e.name:e.title,a="<div class='select2-result-repository clearfix'><div class='select2-result-repository__avatar'><img src='"+e.avatar_small_url+"' /></div><div class='select2-result-repository__meta'><div class='select2-result-repository__title'>"+t+"</div></div>";return a}function s(e){return e.name||e.text}function c(e){for(var t="[",a=0;a<e.length;a++)a>0&&(t+=","),t+='"'+e[a]+'"';return t+"]"}function r(e,t){for(var a=$("#tablist"),n=a.find("div"),s=!1,c=0;c<n.length;c++){var r=$(n[c]);r.find(".tablist-content").html()==e&&(s=r)}"add"==t?s||a.append('<div class="tablist-tag">                                <span class="tablist-close"></span>                                <div class="tablist-content">'+e+"</div>                              </div>"):"delete"==t&&s&&s.remove()}$(document).ready(function(){d.init("#need_reference_queen_ids"),o.init("#need_reference_product_ids");var n={selector:$(".caseSelector"),placeholder:"\u8bf7\u641c\u7d22\u4f60\u60f3\u4f5c\u4e3a\u53c2\u8003\u7684\u6848\u4f8b",url:"/api/queen_works/search",processResultsFuc:function(e){return{results:e.queen_works}}},s={selector:$(".queenSelector"),placeholder:"\u8bf7\u641c\u7d22\u4f60\u60f3\u5408\u4f5c\u7684\u8681\u540e",url:"/api/queens/search",processResultsFuc:function(e){return{results:e.queens}}};e(n),e(s),$(".add-product").click(function(e){var a=$(e.currentTarget).attr("data-id"),n=$(e.currentTarget).attr("data-img"),s=$(e.currentTarget).attr("data-title"),c={avatar_small_url:n,title:s,id:a};o.add(a)&&t(c)}),$(".queenSelector").on("select2:select",function(e){var t=e.params.data.id;d.add(t)&&a(e.params.data)}),$(".caseSelector").on("select2:select",function(e){var a=e.params.data.id;o.add(a)&&t(e.params.data)}),$("a.queen").click(function(e){$(e.currentTarget).toggleClass("selected")}).find("span.delete_btn").click(l),$("form.edit_need").on("submit",function(){$("form.edit_need #need_reference_queen_ids").val(c(d.data)),$("form.edit_need #need_reference_product_ids").val(c(o.data))}),$(document).on("change",".tab-pane .tag input[type=checkbox]",function(){var e=$(this),t=e.closest(".tag").find("label").html();e.prop("checked")?r(t,"add"):r(t,"delete")}),$(document).on("click",".tablist-tag .tablist-close",function(){var e=$(".tab-pane .tag"),t=$(this).closest(".tablist-tag").find(".tablist-content").html();$(this).closest(".tablist-tag").remove();for(var a=0;a<e.length;a++){var n=$(e[a]);n.find("label").html()==t&&n.find("input[type=checkbox]").prop("checked",!1)}})}),$(function(){$(".queenSelector+span").width("1170px");var e=$("div#chooseCase"),t=$("button#sureChoose"),a=$("span.addCase");e.hide(),$("span.addCase,button#sureChoose").click(function(){var n=a.html();"+"==n?(a.css("line-height","30px"),a.html("-")):(a.css("line-height","40px"),a.html("+")),e.toggle(),t.toggle()})});var l=function(e){var t=$(e.currentTarget).attr("data-id"),a="queen"==$(e.currentTarget).attr("data-type");$(e.currentTarget).parents(".col-case-and-queen").remove(),a?(d.del(t),console.log("delete the queen "+t)):(o.del(t),console.log("delete the case "+t))},i=function(){var e,t;return{init:function(a){e=$(a),t=e.val().length>0?e.val().split(","):[]},add:function(a){return t.indexOf(a.toString())<0&&(t.push(a.toString()),e.val(t.toString()),!0)},del:function(a){var n=t.indexOf(a);n>-1&&(t.splice(n,1),e.val(t.toString()))},data:t}},d=new i,o=new i}();